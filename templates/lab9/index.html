<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÅ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –ü–æ–¥–∞—Ä–∫–∏ üéÅ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
            color: white;
            text-align: center;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            color: gold;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .instructions {
            background: rgba(0, 100, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            margin: 20px auto;
            max-width: 800px;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
        }
        
        .stat-box {
            background: rgba(139, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid gold;
            min-width: 200px;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: gold;
        }
        
        .gifts-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
        }
        
        .gift-item {
            width: 150px;
            height: 150px;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .gift-item:hover:not(.opened) {
            transform: scale(1.1);
        }
        
        .gift-item.opened {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .gift-item.locked {
            cursor: not-allowed;
            opacity: 0.5;
            filter: grayscale(50%);
        }
        
        .gift-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .gift-number {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(139, 0, 0, 0.9);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid white;
        }
        
        .lock-icon {
            position: absolute;
            top: 5px;
            left: 5px;
            color: gold;
            font-size: 1.5em;
            text-shadow: 0 0 3px black;
        }
        
        .message-container {
            background: rgba(0, 0, 0, 0.7);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid gold;
            margin: 30px auto;
            max-width: 800px;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .congratulation {
            font-size: 1.5em;
            color: gold;
            margin-bottom: 10px;
        }
        
        .gift-emoji {
            font-size: 3em;
            margin: 10px 0;
        }
        
        .controls {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .btn {
            background: #8b0000;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            border: 2px solid gold;
            font-weight: bold;
        }
        
        .btn:hover:not(:disabled) {
            background: #a00000;
        }
        
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .btn-santa {
            background: linear-gradient(45deg, #8B0000, #B22222, #8B0000);
            border-color: #FFD700;
            font-size: 1.1em;
            padding: 15px 30px;
        }
        
        .auth-panel {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0, 40, 0, 0.7);
            border-radius: 15px;
            border: 2px solid #FFD700;
        }
        
        .auth-form {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
        }
        
        input {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            min-width: 200px;
        }
        
        .user-status {
            font-size: 1.2em;
            color: #FFD700;
            margin-bottom: 15px;
        }
        
        .error {
            color: #ff6b6b;
            background: rgba(255, 0, 0, 0.1);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ff0000;
            margin: 10px 0;
        }
        
        .info {
            color: #90EE90;
            background: rgba(0, 100, 0, 0.2);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #90EE90;
            margin: 10px 0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –ü–æ–¥–∞—Ä–∫–∏ 2025 üéÑ</h1>
        
        <div class="instructions">
            üìå –í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å <strong>–Ω–µ –±–æ–ª–µ–µ 3 –∫–æ—Ä–æ–±–æ–∫</strong>. 
            –ö–∞–∂–¥–∞—è –∫–æ—Ä–æ–±–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ø–æ–¥–∞—Ä–æ–∫.
            <div class="info">
                üîí –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ <strong>–î–µ–¥—É –ú–æ—Ä–æ–∑—É</strong> (–∫–æ—Ä–æ–±–∫–∏ —Å –∑–∞–º–∫–æ–º)
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="user-status" id="user-status">
            üë§ –°—Ç–∞—Ç—É—Å: <span id="username">–ì–æ—Å—Ç—å</span>
        </div>
        
        <div class="stats">
            <div class="stat-box">
                <div>–û—Ç–∫—Ä—ã—Ç–æ –∫–æ—Ä–æ–±–æ–∫</div>
                <div class="stat-value" id="opened-count">0</div>
                <div>–∏–∑ 3 –≤–æ–∑–º–æ–∂–Ω—ã—Ö</div>
            </div>
            
            <div class="stat-box">
                <div>–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥–∞—Ä–∫–æ–≤</div>
                <div class="stat-value" id="remaining">10</div>
                <div>–∏–∑ 10 –≤—Å–µ–≥–æ</div>
            </div>
        </div>
        
        <div class="gifts-container" id="gifts-container">
            <!-- –ö–æ—Ä–æ–±–∫–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã JavaScript -->
        </div>
        
        <div class="message-container">
            <div id="message-content">
                <div class="congratulation">üéÅ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ—Ä–æ–±–∫—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–¥–∞—Ä–æ–∫! üéÅ</div>
            </div>
            <div id="error-message" class="error" style="display: none;"></div>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="resetMyGifts()" id="reset-btn">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –º–æ–∏ –ø–æ–¥–∞—Ä–∫–∏</button>
            <button class="btn" onclick="checkStatus()">üìä –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
            <button class="btn btn-santa" onclick="toggleAuthPanel()" id="santa-btn">üéÖ –°—Ç–∞—Ç—å –î–µ–¥–æ–º –ú–æ—Ä–æ–∑–æ–º</button>
            <button class="btn" onclick="location.reload()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
        </div>
        
        <!-- –ü–∞–Ω–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–∞) -->
        <div class="auth-panel" id="auth-panel" style="display: none;">
            <h3>üéÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞</h3>
            <div class="auth-form">
                <input type="text" id="username-input" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" value="dedmoroz">
                <input type="password" id="password-input" placeholder="–ü–∞—Ä–æ–ª—å" value="2025">
                <button class="btn btn-santa" onclick="login()">–í–æ–π—Ç–∏</button>
            </div>
            <div id="auth-message" class="error" style="display: none;"></div>
            
            <!-- –ü–∞–Ω–µ–ª—å –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞ -->
            <div id="santa-panel" style="display: none; margin-top: 20px;">
                <h4>üéÖ –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞</h4>
                <button class="btn btn-santa" onclick="resetAllGifts()">‚ú® –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –í–°–ï –ø–æ–¥–∞—Ä–∫–∏ (–≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)</button>
                <button class="btn" onclick="logout()" style="margin-left: 15px;">üö™ –í—ã–π—Ç–∏</button>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const TOTAL_GIFTS = 10;
        const MAX_OPENS = 3;
        const GIFT_CLOSED_URL = "/static/lab9/gift_closed.png";
        const GIFT_OPENED_URL = "/static/lab9/gift_opened.png";
        
        // –ü–æ–¥–∞—Ä–∫–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ)
        const LOCKED_GIFTS = [4, 6, 8]; // –≠—Ç–∏ –∫–æ—Ä–æ–±–∫–∏ —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ
        let state = {
            openedCount: 0,
            remaining: TOTAL_GIFTS,
            openedGifts: [],
            canOpenMore: true,
            isAuthenticated: false,
            username: '–ì–æ—Å—Ç—å'
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            createGifts();
            loadState();
            checkAuthStatus();
        });
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–æ–±–æ–∫
        function createGifts() {
            const container = document.getElementById('gifts-container');
            container.innerHTML = '';
            
            for (let i = 1; i <= TOTAL_GIFTS; i++) {
                const isOpened = state.openedGifts.includes(i);
                const requiresAuth = LOCKED_GIFTS.includes(i);
                
                const gift = document.createElement('div');
                gift.className = 'gift-item';
                if (isOpened) {
                    gift.classList.add('opened');
                }
                if (requiresAuth && !state.isAuthenticated && !isOpened) {
                    gift.classList.add('locked');
                }
                gift.id = `gift-${i}`;
                gift.dataset.giftId = i;
                gift.dataset.requiresAuth = requiresAuth;
                
                const img = document.createElement('img');
                img.className = 'gift-image';
                img.src = isOpened ? GIFT_OPENED_URL : GIFT_CLOSED_URL;
                img.alt = `–ö–æ—Ä–æ–±–∫–∞ ${i}`;
                
                const number = document.createElement('div');
                number.className = 'gift-number';
                number.textContent = i;
                
                gift.appendChild(img);
                gift.appendChild(number);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –∑–∞–º–∫–∞ –¥–ª—è –∫–æ—Ä–æ–±–æ–∫, —Ç—Ä–µ–±—É—é—â–∏—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                if (requiresAuth && !state.isAuthenticated && !isOpened) {
                    const lock = document.createElement('div');
                    lock.className = 'lock-icon';
                    lock.innerHTML = 'üîí';
                    gift.appendChild(lock);
                }
                
                // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                if (!isOpened && (!requiresAuth || state.isAuthenticated)) {
                    gift.onclick = () => openGift(i);
                } else if (requiresAuth && !state.isAuthenticated && !isOpened) {
                    gift.onclick = () => showError('–≠—Ç–æ—Ç –ø–æ–¥–∞—Ä–æ–∫ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –î–µ–¥—É –ú–æ—Ä–æ–∑—É! –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å.');
                }
                
                container.appendChild(gift);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        async function loadState() {
            try {
                const response = await fetch('/lab9/status');
                const data = await response.json();
                
                state.openedCount = data.opened_count;
                state.remaining = data.remaining;
                state.openedGifts = data.opened_gifts || [];
                state.canOpenMore = data.can_open_more;
                state.isAuthenticated = data.is_authenticated || false;
                
                updateUI();
                
                // –ü–æ–º–µ—á–∞–µ–º –æ—Ç–∫—Ä—ã—Ç—ã–µ –∫–æ—Ä–æ–±–∫–∏
                state.openedGifts.forEach(giftId => {
                    const gift = document.getElementById(`gift-${giftId}`);
                    if (gift) {
                        gift.classList.add('opened');
                        const img = gift.querySelector('.gift-image');
                        img.src = GIFT_OPENED_URL;
                        img.alt = `–û—Ç–∫—Ä—ã—Ç–∞—è –∫–æ—Ä–æ–±–∫–∞ ${giftId}`;
                        gift.onclick = null;
                    }
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:', error);
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function checkAuthStatus() {
            try {
                const response = await fetch('/lab9/admin/status');
                const data = await response.json();
                
                if (data.is_authenticated) {
                    state.isAuthenticated = true;
                    state.username = data.username;
                    updateAuthUI();
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
            }
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–¥–∞—Ä–∫–∞
        async function openGift(giftId) {
            const gift = document.getElementById(`gift-${giftId}`);
            
            if (gift.classList.contains('opened')) {
                showError('–≠—Ç–∞ –∫–æ—Ä–æ–±–∫–∞ —É–∂–µ –ø—É—Å—Ç–∞!');
                return;
            }
            
            if (!state.canOpenMore) {
                showError('–í—ã —É–∂–µ –æ—Ç–∫—Ä—ã–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Ä–æ–±–æ–∫!');
                return;
            }
            
            try {
                const response = await fetch(`/lab9/open_gift/${giftId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.error) {
                    showError(data.error);
                    return;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                state.openedCount = data.opened_count;
                state.remaining = data.remaining;
                state.openedGifts.push(giftId);
                state.canOpenMore = data.can_open_more;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                updateUI();
                
                // –ú–µ–Ω—è–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—É—é
                gift.classList.add('opened');
                const img = gift.querySelector('.gift-image');
                img.src = GIFT_OPENED_URL;
                img.alt = `–û—Ç–∫—Ä—ã—Ç–∞—è –∫–æ—Ä–æ–±–∫–∞ ${giftId}`;
                
                // –£–±–∏—Ä–∞–µ–º –∏–∫–æ–Ω–∫—É –∑–∞–º–∫–∞ –µ—Å–ª–∏ –±—ã–ª–∞
                const lock = gift.querySelector('.lock-icon');
                if (lock) {
                    lock.remove();
                }
                
                // –£–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                gift.onclick = null;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è
                gift.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    gift.style.transform = 'scale(1)';
                }, 300);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
                showCongratulations(data.message, data.image, giftId, data.requires_auth);
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
        function showCongratulations(message, emoji, giftId, requiresAuth) {
            let authInfo = '';
            if (requiresAuth) {
                authInfo = '<div class="info" style="margin-top: 10px;">‚ú® –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ –¥–ª—è –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞!</div>';
            }
            
            document.getElementById('message-content').innerHTML = `
                <div class="congratulation">${message}</div>
                <div class="gift-emoji">${emoji}</div>
                <div style="color: #90ee90; margin-top: 10px;">
                    üéâ –í—ã –æ—Ç–∫—Ä—ã–ª–∏ –∫–æ—Ä–æ–±–∫—É ‚Ññ${giftId}! üéâ
                </div>
                ${authInfo}
            `;
            
            hideError();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            setTimeout(hideError, 3000);
        }
        
        // –°–∫—Ä—ã—Ç—å –æ—à–∏–±–∫—É
        function hideError() {
            document.getElementById('error-message').style.display = 'none';
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å UI
        function updateUI() {
            document.getElementById('opened-count').textContent = state.openedCount;
            document.getElementById('remaining').textContent = state.remaining;
            
            const resetBtn = document.getElementById('reset-btn');
            resetBtn.disabled = state.openedCount === 0;
            
            document.getElementById('username').textContent = state.username;
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å UI –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function updateAuthUI() {
            document.getElementById('username').textContent = state.username;
            
            if (state.isAuthenticated) {
                document.getElementById('santa-btn').textContent = 'üéÖ –í—ã - –î–µ–¥ –ú–æ—Ä–æ–∑';
                document.getElementById('santa-btn').style.background = 'linear-gradient(45deg, #006400, #228B22)';
                document.getElementById('santa-panel').style.display = 'block';
                
                // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –∫–æ—Ä–æ–±–∫–∏, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –∑–∞–º–∫–∏
                createGifts();
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function toggleAuthPanel() {
            const panel = document.getElementById('auth-panel');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        }
        
        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        async function login() {
            const username = document.getElementById('username-input').value;
            const password = document.getElementById('password-input').value;
            
            if (!username || !password) {
                showAuthError('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—å');
                return;
            }
            
            try {
                const response = await fetch('/lab9/admin/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    state.isAuthenticated = true;
                    state.username = '–î–µ–¥ –ú–æ—Ä–æ–∑';
                    updateAuthUI();
                    showAuthMessage('–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è! ' + data.message);
                    setTimeout(() => {
                        document.getElementById('auth-message').style.display = 'none';
                        document.getElementById('auth-panel').style.display = 'none';
                    }, 2000);
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—Ä–æ–±–∫–∏
                    createGifts();
                    
                } else {
                    showAuthError(data.error);
                }
                
            } catch (error) {
                showAuthError('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ' + error.message);
            }
        }
        
        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        async function logout() {
            try {
                const response = await fetch('/lab9/admin/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    state.isAuthenticated = false;
                    state.username = '–ì–æ—Å—Ç—å';
                    updateAuthUI();
                    document.getElementById('santa-btn').textContent = 'üéÖ –°—Ç–∞—Ç—å –î–µ–¥–æ–º –ú–æ—Ä–æ–∑–æ–º';
                    document.getElementById('santa-btn').style.background = '';
                    document.getElementById('santa-panel').style.display = 'none';
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—Ä–æ–±–∫–∏
                    createGifts();
                    
                    alert(data.message);
                }
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function showAuthError(message) {
            const authError = document.getElementById('auth-message');
            authError.textContent = message;
            authError.style.display = 'block';
            authError.className = 'error';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function showAuthMessage(message) {
            const authMessage = document.getElementById('auth-message');
            authMessage.textContent = message;
            authMessage.style.display = 'block';
            authMessage.className = 'info';
        }
        
        // –°–±—Ä–æ—Å–∏—Ç—å –º–æ–∏ –ø–æ–¥–∞—Ä–∫–∏
        async function resetMyGifts() {
            if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–¥–∞—Ä–∫–∏?')) return;
            
            try {
                const response = await fetch('/lab9/reset_gifts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    location.reload();
                }
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ');
            }
        }
        
        // –°–±—Ä–æ—Å–∏—Ç—å –í–°–ï –ø–æ–¥–∞—Ä–∫–∏ (–¥–ª—è –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞)
        async function resetAllGifts() {
            if (!state.isAuthenticated) {
                showError('–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –î–µ–¥—É –ú–æ—Ä–æ–∑—É!');
                return;
            }
            
            if (!confirm('üéÖ –î–µ–¥ –ú–æ—Ä–æ–∑, –≤—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –í–°–ï –ø–æ–¥–∞—Ä–∫–∏ –¥–ª—è –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                return;
            }
            
            try {
                const response = await fetch('/lab9/admin/reset_all', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(data.message);
                    location.reload();
                } else {
                    showError(data.error);
                }
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤—Å–µ—Ö –ø–æ–¥–∞—Ä–∫–æ–≤');
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
        async function checkStatus() {
            try {
                const response = await fetch('/lab9/status');
                const data = await response.json();
                
                let authStatus = '–ì–æ—Å—Ç—å';
                if (data.is_authenticated) {
                    authStatus = '–î–µ–¥ –ú–æ—Ä–æ–∑';
                }
                
                alert(`üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:\n\n` +
                      `–í—Å–µ–≥–æ –ø–æ–¥–∞—Ä–∫–æ–≤: ${data.total_gifts}\n` +
                      `–û—Ç–∫—Ä—ã—Ç–æ –≤–∞–º–∏: ${data.opened_count}\n` +
                      `–û—Å—Ç–∞–ª–æ—Å—å: ${data.remaining}\n` +
                      `–ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –µ—â–µ: ${data.can_open_more ? '–î–∞' : '–ù–µ—Ç'}\n` +
                      `–°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${authStatus}\n` +
                      `–û—Ç–∫—Ä—ã—Ç—ã–µ –∫–æ—Ä–æ–±–∫–∏: ${data.opened_gifts.join(', ') || '–Ω–µ—Ç'}`);
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞');
            }
        }
    </script>
</body>
</html>