{% extends "base.html" %}

{% block lab %}–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 7{% endblock %}

{% block script %}
<script src="{{ url_for('static', filename='lab7/main.js') }}"></script>
<style>
    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
    .film-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .film-table th {
        background-color: #4CAF50;
        color: white;
        padding: 12px;
        text-align: left;
        border: 1px solid #ddd;
        font-weight: bold;
    }
    
    .film-table td {
        padding: 12px;
        border: 1px solid #ddd;
        vertical-align: top;
    }
    
    .film-table tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    
    .film-table tr:hover {
        background-color: #f5f5f5;
        transition: background-color 0.3s;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
    .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
        font-family: inherit;
        margin: 2px;
    }
    
    .btn-primary {
        background-color: #4CAF50;
        color: white;
    }
    
    .btn-primary:hover {
        background-color: #45a049;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .btn-edit {
        background-color: #FF9800;
        color: white;
    }
    
    .btn-edit:hover {
        background-color: #e68900;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .btn-delete {
        background-color: #f44336;
        color: white;
    }
    
    .btn-delete:hover {
        background-color: #d32f2f;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .btn-add {
        background-color: #9C27B0;
        color: white;
        padding: 12px 24px;
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 20px;
    }
    
    .btn-add:hover {
        background-color: #7b1fa2;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .btn-secondary {
        background-color: #607d8b;
        color: white;
    }
    
    .btn-secondary:hover {
        background-color: #546e7a;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º */
    .form-group {
        margin-bottom: 15px;
    }
    
    .form-label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #333;
    }
    
    .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
        font-family: inherit;
        font-size: 14px;
    }
    
    .form-control:focus {
        border-color: #4CAF50;
        outline: none;
        box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—à–∏–±–æ–∫ */
    .error-message {
        color: #f44336;
        font-size: 12px;
        margin-top: 5px;
        font-style: italic;
    }
    
    .error-field {
        border-color: #f44336 !important;
        background-color: #ffebee;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π */
    .success-message {
        color: #4CAF50;
        font-weight: bold;
        padding: 15px;
        background-color: #e8f5e9;
        border-radius: 4px;
        border-left: 4px solid #4CAF50;
        margin-bottom: 20px;
    }
    
    .error-box {
        color: #f44336;
        padding: 15px;
        background-color: #ffebee;
        border-radius: 4px;
        border-left: 4px solid #f44336;
        margin-bottom: 20px;
    }
    
    .info-box {
        color: #2196F3;
        padding: 15px;
        background-color: #e3f2fd;
        border-radius: 4px;
        border-left: 4px solid #2196F3;
        margin-bottom: 20px;
    }
    
    .db-info {
        color: #9C27B0;
        padding: 15px;
        background-color: #f3e5f5;
        border-radius: 4px;
        border-left: 4px solid #9C27B0;
        margin-bottom: 20px;
    }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
    .card {
        background: #fff;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border: 1px solid #e0e0e0;
    }
    
    .card h3, .card h4 {
        margin-top: 0;
        color: #333;
        border-bottom: 2px solid #4CAF50;
        padding-bottom: 10px;
        margin-bottom: 15px;
    }
    
    /* –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
    .output-panel {
        background: #f9f9f9;
        border: 1px solid #ddd;
        padding: 20px;
        border-radius: 5px;
        min-height: 300px;
        font-family: 'Courier New', monospace;
        white-space: pre-wrap;
        overflow: auto;
        max-height: 500px;
        font-size: 14px;
    }
    
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã */
    .container {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .sidebar {
        flex: 1;
        border-right: 1px solid #e0e0e0;
        padding-right: 20px;
    }
    
    .content {
        flex: 2;
    }
    
    /* –ü—Ä–∏–º–µ—á–∞–Ω–∏—è */
    .note {
        font-size: 12px;
        color: #666;
        font-style: italic;
        margin-top: 5px;
    }
    
    /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
    .stats {
        background: #e8f5e9;
        padding: 15px;
        border-radius: 5px;
        margin-top: 10px;
    }
    
    .stats p {
        margin: 5px 0;
    }
    
    .stat-value {
        font-weight: bold;
        color: #4CAF50;
        font-size: 1.1em;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
        .container {
            flex-direction: column;
        }
        
        .sidebar {
            border-right: none;
            border-bottom: 1px solid #e0e0e0;
            padding-right: 0;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        
        .film-table {
            font-size: 14px;
        }
        
        .film-table th,
        .film-table td {
            padding: 8px;
        }
        
        .btn {
            padding: 6px 12px;
            font-size: 13px;
        }
    }
    
    /* API –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
    .api-info {
        background: #e3f2fd;
        border-left: 4px solid #2196F3;
        padding: 15px;
        margin-top: 20px;
        border-radius: 4px;
    }
    
    .api-info ul {
        margin: 10px 0;
        padding-left: 20px;
    }
    
    .api-info li {
        margin-bottom: 5px;
        line-height: 1.4;
    }
    
    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ */
    .additional-task {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        border: 2px dashed #4CAF50;
    }
    
    .task-checklist {
        list-style-type: none;
        padding-left: 0;
    }
    
    .task-checklist li {
        padding: 8px 0 8px 30px;
        position: relative;
    }
    
    .task-checklist li:before {
        content: "‚úì";
        position: absolute;
        left: 0;
        color: #4CAF50;
        font-weight: bold;
        font-size: 18px;
    }
</style>
{% endblock %}

{% block main %}
    <h1>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 7</h1>
    <h2>API REST - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å–º–∞–º–∏</h2>
    
    <div class="additional-task">
        <h3>‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –í–´–ü–û–õ–ù–ï–ù–û</h3>
        <ul class="task-checklist">
            <li><strong>–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ:</strong> –†—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –µ—Å–ª–∏ —Ä—É—Å—Å–∫–æ–µ –ø—É—Å—Ç–æ–µ, –≥–æ–¥ –æ—Ç 1895 –¥–æ —Ç–µ–∫—É—â–µ–≥–æ, –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –±–æ–ª–µ–µ 2000 —Å–∏–º–≤–æ–ª–æ–≤</li>
            <li><strong>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:</strong> –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –≤ SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–ª—å–º–æ–≤, –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏</li>
            <li><strong>CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏:</strong> –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, —á—Ç–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ) —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ REST API —Å –ë–î</li>
        </ul>
    </div>
    
    <div class="db-info">
        <strong>üìÅ –§–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:</strong> lab7_films.db<br>
        <strong>üìä –¢–∞–±–ª–∏—Ü–∞:</strong> lab7_movies<br>
        <strong>üß™ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:</strong> Flask, SQLAlchemy, SQLite, REST API
    </div>
    
    <div style="margin-bottom: 30px;">
        <h3>–°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤</h3>
        <table class="film-table">
            <thead>
                <tr>
                    <th>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ (—Ä—É—Å)</th>
                    <th>–ì–æ–¥</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody id="film-list">
                <tr>
                    <td colspan="4" style="padding: 20px; text-align: center; color: #666;">
                        –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–ª—å–º–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...
                    </td>
                </tr>
            </tbody>
        </table>
        
        <div style="text-align: center; margin-bottom: 30px;">
            <button onclick="addFilm()" class="btn btn-add">
                <span>+</span> –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º
            </button>
        </div>
    </div>
    
    <div class="container">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API -->
        <div class="sidebar">
            <h3>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</h3>
            
            <div class="card">
                <h4>1. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å–º—ã (JSON)</h4>
                <button onclick="fetch('/lab7/rest-api/films/').then(r => r.json()).then(data => {
                    document.getElementById('output').innerHTML = '<div class=\"card\"><h3>–í—Å–µ —Ñ–∏–ª—å–º—ã (–∏–∑ –ë–î):</h3><pre>' + JSON.stringify(data, null, 2) + '</pre></div>';
                " class="btn btn-primary">
                    –ü–æ–ª—É—á–∏—Ç—å JSON –∏–∑ –ë–î
                </button>
                <p class="note">–ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Ñ–∏–ª—å–º—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite</p>
            </div>
            
            <div class="card">
                <h4>2. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–ª—å–º</h4>
                <div class="form-group">
                    <label class="form-label">ID —Ñ–∏–ª—å–º–∞:</label>
                    <input type="number" id="editId" value="1" min="1" class="form-control" style="width: 80px;">
                </div>
                <div class="form-group">
                    <label class="form-label">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="editTitle" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                    <div class="note">–ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Ä—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</div>
                </div>
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ (—Ä—É—Å): <span style="color: #f44336;">*</span></label>
                    <input type="text" id="editTitleRu" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ì–æ–¥: <span style="color: #f44336;">*</span></label>
                    <input type="number" id="editYear" min="1895" max="2025" class="form-control" placeholder="–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞" style="width: 120px;">
                </div>
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ: <span style="color: #f44336;">*</span></label>
                    <textarea id="editDescription" rows="3" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞ (–º–∞–∫—Å–∏–º—É–º 2000 —Å–∏–º–≤–æ–ª–æ–≤)"></textarea>
                    <div class="note">–ú–∞–∫—Å–∏–º—É–º 2000 —Å–∏–º–≤–æ–ª–æ–≤</div>
                </div>
                <button onclick="editFilmSubmit()" class="btn btn-edit">
                    –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–ª—å–º –≤ –ë–î
                </button>
                <p class="note">
                    <span style="color: #f44336;">*</span> - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
                </p>
            </div>
            
            <div class="card">
                <h4>3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h4>
                <div class="stats">
                    <p>–í—Å–µ–≥–æ —Ñ–∏–ª—å–º–æ–≤ –≤ –±–∞–∑–µ: <span class="stat-value" id="films-count">{{ films_count }}</span></p>
                    <p>–ü–æ—Å–ª–µ–¥–Ω–∏–π ID: <span class="stat-value" id="max-id">-</span></p>
                    <p>–ì–æ–¥ –ø–µ—Ä–≤–æ–≥–æ —Ñ–∏–ª—å–º–∞: <span class="stat-value">1895</span></p>
                    <p>–ì–æ–¥ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ñ–∏–ª—å–º–∞: <span class="stat-value">2025</span></p>
                </div>
            </div>
        </div>
        
        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div class="content">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:</h3>
            <div id="output" class="output-panel">
                –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...
                <p class="note">–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ SQLite –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</p>
            </div>
        </div>
    </div>
    
    <div class="card api-info">
        <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ REST API:</h3>
        <ul>
            <li><strong>GET /lab7/rest-api/films/</strong> - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å–º—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</li>
            <li><strong>GET /lab7/rest-api/films/&lt;id&gt;</strong> - –ø–æ–ª—É—á–∏—Ç—å —Ñ–∏–ª—å–º –ø–æ ID –∏–∑ –ë–î</li>
            <li><strong>DELETE /lab7/rest-api/films/&lt;id&gt;</strong> - —É–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å–º –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</li>
            <li><strong>PUT /lab7/rest-api/films/&lt;id&gt;</strong> - –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–ª—å–º –≤ –ë–î</li>
            <li><strong>POST /lab7/rest-api/films/</strong> - –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∏–ª—å–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö</li>
        </ul>
        <div class="note">
            <strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:</strong><br>
            ‚Ä¢ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ SQLite –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (—Ñ–∞–π–ª lab7_films.db)<br>
            ‚Ä¢ –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π<br>
            ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ<br>
            ‚Ä¢ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
        </div>
    </div>
    
    <script>
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∏–ª—å–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            fillFilmList();
            
            // –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ
            document.addEventListener('focusin', function(event) {
                if (event.target && (event.target.id.startsWith('new') || event.target.id.startsWith('edit'))) {
                    event.target.classList.remove('error-field');
                    const errorMsg = event.target.parentNode.querySelector('.error-message');
                    if (errorMsg) {
                        errorMsg.remove();
                    }
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –≥–æ–¥ –≤ –ø–æ–ª–µ –≥–æ–¥–∞
            const currentYear = new Date().getFullYear();
            const editYearField = document.getElementById('editYear');
            if (editYearField) {
                editYearField.max = currentYear;
                editYearField.value = currentYear;
            }
        });
    </script>
{% endblock %}